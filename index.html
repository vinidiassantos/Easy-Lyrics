<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Easy Lyrics</title>
</head>
<body>
  <h1>🎸 Easy Lyrics</h1>

  <textarea id="htmlInput" rows="15" cols="100" placeholder="Cole aqui o código-fonte da página do Cifra Club..."></textarea><br><br>

  <button onclick="extrairCifra()">🎼 Extrair Cifra</button>
  <button onclick="verHistorico()">📚 Ver Histórico</button>
  <button onclick="limparHistorico()">🗑️ Limpar Histórico</button>

  <h2>Resultado:</h2>
  <pre id="output"></pre>

  <script>
    function extrairCifra() {
      const html = document.getElementById("htmlInput").value;
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      const cifraEl = doc.querySelector("pre.cifra");

      if (cifraEl) {
        const cifraText = cifraEl.innerText;
        document.getElementById("output").textContent = cifraText;

        salvarNoHistorico(cifraText);
      } else {
        document.getElementById("output").textContent = "❌ Não foi possível encontrar a cifra.";
      }
    }

    function salvarNoHistorico(cifra) {
      let historico = JSON.parse(localStorage.getItem("historicoCifras")) || [];
      historico.unshift({
        data: new Date().toLocaleString(),
        cifra: cifra
      });
      localStorage.setItem("historicoCifras", JSON.stringify(historico));
    }

    function verHistorico() {
      let historico = JSON.parse(localStorage.getItem("historicoCifras")) || [];
      if (historico.length === 0) {
        alert("⚠️ Nenhuma cifra salva no histórico.");
        return;
      }

      let resultado = "🎵 Histórico de Cifras:\n\n";
      historico.forEach((item, index) => {
        resultado += `#${index + 1} – ${item.data}\n${item.cifra.slice(0, 300)}...\n\n`; // Mostra início da cifra
      });

      alert(resultado);
    }

    function limparHistorico() {
      if (confirm("Tem certeza que deseja apagar o histórico?")) {
        localStorage.removeItem("historicoCifras");
        alert("✅ Histórico apagado com sucesso.");
      }
    }
  </script>
</body>
</html>
